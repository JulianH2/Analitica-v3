{
  "ingreso_viaje": {
    "name": "Ingreso Viaje (Subtotal)",
    "recipe": {
      "table": "h_viaje",
      "column": "subtotal",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "ingreso_viaje_anterior": {
    "name": "Ingreso Viaje Año Anterior",
    "recipe": {
      "table": "h_viaje",
      "column": "subtotal",
      "aggregation": "SUM",
      "time_modifier": "previous_year",
      "format": "currency"
    }
  },
  "ingreso_viaje_acumulado": {
    "name": "Ingreso Viaje Acumulado (YTD)",
    "recipe": {
      "table": "h_viaje",
      "column": "subtotal",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "currency"
    }
  },
  "meta_ingreso_viaje": {
    "name": "Meta Ingreso Viaje",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_ingreso_viaje",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "ingreso_esperado": {
    "name": "Ingreso Esperado",
    "description": "Alias de Meta para contextos de proyección",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_ingreso_viaje",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "pct_desviacion_ingreso_vs_anterior": {
    "name": "% Desviación Ingreso vs Anterior",
    "type": "derived",
    "formula": "(ingreso_viaje - ingreso_viaje_anterior) / ingreso_viaje_anterior",
    "format": "percent"
  },
  "pct_desviacion_ingreso_acumulado": {
    "name": "% Desviación Ingreso Acumulado",
    "type": "derived",
    "formula": "(ingreso_viaje_acumulado - meta_ingreso_viaje_acumulado) / meta_ingreso_viaje_acumulado",
    "format": "percent"
  },
  "viajes": {
    "name": "Viajes",
    "recipe": {
      "table": "h_viaje",
      "column": "no_viaje",
      "aggregation": "COUNT",
      "format": "integer"
    }
  },
  "viajes_anterior": {
    "name": "Viajes Año Anterior",
    "recipe": {
      "table": "h_viaje",
      "column": "no_viaje",
      "aggregation": "COUNT",
      "time_modifier": "previous_year",
      "format": "integer"
    }
  },
  "viajes_acumulado": {
    "name": "Viajes Acumulado (YTD)",
    "recipe": {
      "table": "h_viaje",
      "column": "no_viaje",
      "aggregation": "COUNT",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "meta_viajes": {
    "name": "Meta Viaje",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_viajes",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "viajes_esperado": {
    "name": "Viajes Esperado",
    "description": "Proyección de viajes basada en meta",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_viajes",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "meta_viajes_acumulado": {
    "name": "Meta Viajes Acumulado (YTD)",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_viajes",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "diff_viajes_vs_anterior": {
    "name": "Viajes vs Anterior",
    "type": "derived",
    "formula": "viajes - viajes_anterior",
    "format": "integer"
  },
  "pct_desviacion_viajes_vs_anterior": {
    "name": "% Desviación Viajes vs Anterior",
    "type": "derived",
    "formula": "(viajes - viajes_anterior) / viajes_anterior",
    "format": "percent"
  },
  "pct_desviacion_viajes_acumulado": {
    "name": "% Desviación Viajes Acumulado",
    "type": "derived",
    "formula": "(viajes_acumulado - meta_viajes_acumulado) / meta_viajes_acumulado",
    "format": "percent"
  },
  "kilometros": {
    "name": "Kms Recorridos",
    "recipe": {
      "table": "h_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "kilometros_anterior": {
    "name": "Kms Recorridos Año Anterior",
    "recipe": {
      "table": "h_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "time_modifier": "previous_year",
      "format": "integer"
    }
  },
  "kilometros_acumulado": {
    "name": "Kms Recorridos Acumulado (YTD)",
    "recipe": {
      "table": "h_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "meta_kilometros": {
    "name": "Meta Kms Real",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_kms_recorridos",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "kilometros_esperado": {
    "name": "Kilómetros Esperado",
    "description": "Alias de Meta Kms para proyecciones",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_kms_real",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "meta_ingreso_viaje_acumulado": {
    "name": "Meta Ingreso Viaje Acumulado (YTD)",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_ingreso_viaje",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "currency"
    }
  },
  "meta_kilometros_acumulado": {
    "name": "Meta Kms Real Acumulado (YTD)",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_kms_recorridos",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "pct_desviacion_kilometros_vs_anterior": {
    "name": "% Desviación Kms Real vs Anterior",
    "type": "derived",
    "formula": "(kilometros - kilometros_anterior) / kilometros_anterior",
    "format": "percent"
  },
  "pct_desviacion_kilometros_acumulado": {
    "name": "% Desviación Kms Real Acumulado",
    "type": "derived",
    "formula": "(kilometros_acumulado - meta_kilometros_acumulado) / meta_kilometros_acumulado",
    "format": "percent"
  },
  "costo_viaje": {
    "name": "Costo Viaje Total",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_concepto",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "flete": {
    "name": "Flete",
    "recipe": {
      "table": "h_viaje",
      "column": "flete",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "otros_costos": {
    "name": "Otros Costos",
    "recipe": {
      "table": "h_viaje",
      "column": "otros",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "kms_viaje": {
    "name": "Kms Viaje",
    "recipe": {
      "table": "d_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "format": "integer"
    },
    "description": "Justificación KB: d_viaje[kms_viaje] (cite: 140)"
  },
  "otros_ingresos": {
    "name": "Otros Ingresos",
    "type": "derived",
    "formula": "ingreso_viaje - flete",
    "format": "currency"
  },
  "sueldo_operador": {
    "name": "Sueldo Operador",
    "recipe": {
      "table": "d_viaje",
      "column": "sueldo_operador",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "costo_liquidacion": {
    "name": "Costo Liquidación",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_concepto",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "ingreso_x_km": {
    "name": "Ingreso x Km",
    "type": "derived",
    "formula": "ingreso_viaje / kms_viaje if kms_viaje else 0",
    "format": "currency"
  },
  "ingreso_x_viaje": {
    "name": "Ingreso x Viaje",
    "type": "derived",
    "formula": "ingreso_viaje / viajes if viajes else 0",
    "format": "currency"
  },
  "costo_viaje_total": {
    "name": "Costo Viaje Total",
    "type": "derived",
    "formula": "costo_liquidacion",
    "format": "currency",
    "description": "Base para cálculo de utilidad"
  },
  "utilidad": {
    "name": "Monto Utilidad",
    "type": "derived",
    "formula": "ingreso_viaje - costo_viaje_total",
    "format": "currency"
  },
  "margen_utilidad": {
    "name": "% Margen Utilidad Viaje",
    "type": "derived",
    "formula": "(ingreso_viaje - costo_viaje_total) / ingreso_viaje if ingreso_viaje else 0",
    "format": "percent"
  },
  "costo_x_km": {
    "name": "Costo Viaje x Km",
    "type": "derived",
    "formula": "costo_viaje_total / kms_viaje if kms_viaje else 0",
    "format": "currency"
  },
  "combustible": {
    "name": "Combustible",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_combustible",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "caseta_iave": {
    "name": "Caseta IAVE",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_caseta_iave",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "caseta_efectivo": {
    "name": "Caseta Efectivo",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_caseta_efectivo",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "unidades_utilizadas": {
    "name": "Unidades Utilizadas",
    "recipe": {
      "table": "d_viaje",
      "column": "id_unidad",
      "aggregation": "DISTINCTCOUNT"
    },
    "format": "integer"
  },
  "unidades_utilizadas_anterior": {
    "name": "Unidades Utilizadas Año Anterior",
    "recipe": {
      "table": "d_viaje",
      "column": "id_unidad",
      "aggregation": "DISTINCTCOUNT",
      "time_modifier": "previous_year"
    },
    "format": "integer"
  },
  "pct_desviacion_unidades_vs_anterior": {
    "name": "% Desviación Unidades Utilizadas vs Anterior",
    "type": "derived",
    "formula": "(unidades_utilizadas - unidades_utilizadas_anterior) / unidades_utilizadas_anterior",
    "format": "percent"
  },
  "ingreso_unit": {
    "name": "Ingreso por Tractocamión",
    "type": "derived",
    "formula": "ingreso_viaje / unidades_utilizadas",
    "format": "currency"
  },
  "ingreso_unit_anterior": {
    "name": "Ingreso por Unidad Año Anterior",
    "type": "derived",
    "formula": "ingreso_viaje_anterior / unidades_utilizadas_anterior",
    "format": "currency"
  },
  "pct_desviacion_ingreso_unit_anterior": {
    "name": "% Desviación Ingreso x Unidad vs Anterior",
    "type": "derived",
    "formula": "(ingreso_unit - ingreso_unit_anterior) / ingreso_unit_anterior",
    "format": "percent"
  },
  "clientes_servidos": {
    "name": "Clientes Servidos",
    "recipe": {
      "table": "d_trafico_guia",
      "column": "id_cliente",
      "aggregation": "DISTINCTCOUNT"
    },
    "format": "integer"
  },
  "clientes_servidos_anterior": {
    "name": "Clientes Servidos Año Anterior",
    "recipe": {
      "table": "d_trafico_guia",
      "column": "id_cliente",
      "aggregation": "DISTINCTCOUNT",
      "time_modifier": "previous_year"
    },
    "format": "integer"
  },
  "pct_desviacion_clientes_vs_anterior": {
    "name": "% Desviación Clientes vs Anterior",
    "type": "derived",
    "formula": "(clientes_servidos - clientes_servidos_anterior) / clientes_servidos_anterior",
    "format": "percent"
  },
  "viajes_cargados": {
    "name": "Viajes con Carga",
    "recipe": {
      "table": "d_viaje",
      "column": "ind_cargado",
      "aggregation": "SUM"
    },
    "format": "integer"
  },
  "utilizacion_flota": {
    "name": "Porcentaje de Carga",
    "type": "derived",
    "formula": "(viajes_cargados / viajes) * 100",
    "format": "percent"
  }
}