{
  "_metadata": {
    "version": "2.0",
    "description": "Métricas completas sincronizadas con screens.json",
    "last_updated": "2025-02-02"
  },

  "trip_revenue": {
    "name": "Ingreso Viaje (Subtotal)",
    "recipe": {
      "table": "h_viaje",
      "column": "subtotal",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "trip_revenue_previous_year": {
    "name": "Ingreso Viaje Año Anterior",
    "recipe": {
      "table": "h_viaje",
      "column": "subtotal",
      "aggregation": "SUM",
      "time_modifier": "previous_year",
      "format": "currency"
    }
  },
  "trip_revenue_ytd": {
    "name": "Ingreso Viaje Acumulado (YTD)",
    "recipe": {
      "table": "h_viaje",
      "column": "subtotal",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "currency"
    }
  },
  "trip_revenue_target": {
    "name": "Meta Ingreso Viaje",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_ingreso_viaje",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "trip_revenue_target_ytd": {
    "name": "Meta Ingreso Viaje Acumulado (YTD)",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_ingreso_viaje",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "currency"
    }
  },
  "expected_revenue": {
    "name": "Ingreso Esperado",
    "description": "Alias de Meta para contextos de proyección",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_ingreso_viaje",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "revenue_vs_previous_year_pct": {
    "name": "% Desviación Ingreso vs Anterior",
    "type": "derived",
    "formula": "(trip_revenue - trip_revenue_previous_year) / trip_revenue_previous_year",
    "format": "percent"
  },
  "revenue_ytd_vs_target_pct": {
    "name": "% Desviación Ingreso Acumulado",
    "type": "derived",
    "formula": "(trip_revenue_ytd - trip_revenue_target_ytd) / trip_revenue_target_ytd",
    "format": "percent"
  },

  "trips": {
    "name": "Viajes",
    "recipe": {
      "table": "h_viaje",
      "column": "no_viaje",
      "aggregation": "COUNT",
      "format": "integer"
    }
  },
  "trips_previous_year": {
    "name": "Viajes Año Anterior",
    "recipe": {
      "table": "h_viaje",
      "column": "no_viaje",
      "aggregation": "COUNT",
      "time_modifier": "previous_year",
      "format": "integer"
    }
  },
  "trips_ytd": {
    "name": "Viajes Acumulado (YTD)",
    "recipe": {
      "table": "h_viaje",
      "column": "no_viaje",
      "aggregation": "COUNT",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "trips_target": {
    "name": "Meta Viajes",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_viajes",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "trips_target_ytd": {
    "name": "Meta Viajes Acumulado (YTD)",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_viajes",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "trips_vs_previous_diff": {
    "name": "Viajes vs Anterior (Diferencia)",
    "type": "derived",
    "formula": "trips - trips_previous_year",
    "format": "integer"
  },
  "trips_vs_previous_year_pct": {
    "name": "% Desviación Viajes vs Anterior",
    "type": "derived",
    "formula": "(trips - trips_previous_year) / trips_previous_year",
    "format": "percent"
  },
  "trips_ytd_vs_target_pct": {
    "name": "% Desviación Viajes Acumulado",
    "type": "derived",
    "formula": "(trips_ytd - trips_target_ytd) / trips_target_ytd",
    "format": "percent"
  },

  "kilometers": {
    "name": "Kms Recorridos",
    "recipe": {
      "table": "h_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "kilometers_previous_year": {
    "name": "Kms Recorridos Año Anterior",
    "recipe": {
      "table": "h_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "time_modifier": "previous_year",
      "format": "integer"
    }
  },
  "kilometers_ytd": {
    "name": "Kms Recorridos Acumulado (YTD)",
    "recipe": {
      "table": "h_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "kilometers_target": {
    "name": "Meta Kms",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_kms_recorridos",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "kilometers_target_ytd": {
    "name": "Meta Kms Acumulado (YTD)",
    "recipe": {
      "table": "d_meta_tiempo",
      "column": "meta_kms_recorridos",
      "aggregation": "SUM",
      "time_modifier": "ytd",
      "format": "integer"
    }
  },
  "kilometers_vs_previous_year_pct": {
    "name": "% Desviación Kms vs Anterior",
    "type": "derived",
    "formula": "(kilometers - kilometers_previous_year) / kilometers_previous_year",
    "format": "percent"
  },
  "kilometers_ytd_vs_target_pct": {
    "name": "% Desviación Kms Acumulado",
    "type": "derived",
    "formula": "(kilometers_ytd - kilometers_target_ytd) / kilometers_target_ytd",
    "format": "percent"
  },

  "trip_costs": {
    "name": "Costo Viaje Total",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_concepto",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "settlement_costs": {
    "name": "Costo Liquidación",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_concepto",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "total_trip_costs": {
    "name": "Costo Viaje Total",
    "type": "derived",
    "formula": "settlement_costs",
    "format": "currency",
    "description": "Base para cálculo de utilidad"
  },
  "freight": {
    "name": "Flete",
    "recipe": {
      "table": "h_viaje",
      "column": "flete",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "other_costs": {
    "name": "Otros Costos",
    "recipe": {
      "table": "h_viaje",
      "column": "otros",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "trip_km": {
    "name": "Kms Viaje",
    "recipe": {
      "table": "d_viaje",
      "column": "kms_viaje",
      "aggregation": "SUM",
      "format": "integer"
    }
  },
  "other_revenue": {
    "name": "Otros Ingresos",
    "type": "derived",
    "formula": "trip_revenue - freight",
    "format": "currency"
  },
  "driver_salary": {
    "name": "Sueldo Operador",
    "recipe": {
      "table": "d_viaje",
      "column": "sueldo_operador",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "revenue_per_km": {
    "name": "Ingreso x Km",
    "type": "derived",
    "formula": "trip_revenue / kilometers if kilometers else 0",
    "format": "currency"
  },
  "revenue_per_trip": {
    "name": "Ingreso x Viaje",
    "type": "derived",
    "formula": "trip_revenue / trips if trips else 0",
    "format": "currency"
  },
  "net_profit": {
    "name": "Monto Utilidad",
    "type": "derived",
    "formula": "trip_revenue - total_trip_costs",
    "format": "currency"
  },
  "profit_margin": {
    "name": "% Margen Utilidad Viaje",
    "type": "derived",
    "formula": "(trip_revenue - total_trip_costs) / trip_revenue if trip_revenue else 0",
    "format": "percent"
  },
  "cost_per_km": {
    "name": "Costo Viaje x Km",
    "type": "derived",
    "formula": "total_trip_costs / kilometers if kilometers else 0",
    "format": "currency"
  },

  "fuel": {
    "name": "Combustible",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_combustible",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "toll_iave": {
    "name": "Caseta IAVE",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_caseta_iave",
      "aggregation": "SUM",
      "format": "currency"
    }
  },
  "toll_cash": {
    "name": "Caseta Efectivo",
    "recipe": {
      "table": "h_viajes_gastos_liquidacion",
      "column": "monto_caseta_efectivo",
      "aggregation": "SUM",
      "format": "currency"
    }
  },

  "units_used": {
    "name": "Unidades Utilizadas",
    "recipe": {
      "table": "d_viaje",
      "column": "id_unidad",
      "aggregation": "DISTINCTCOUNT"
    },
    "format": "integer"
  },
  "units_used_previous_year": {
    "name": "Unidades Utilizadas Año Anterior",
    "recipe": {
      "table": "d_viaje",
      "column": "id_unidad",
      "aggregation": "DISTINCTCOUNT",
      "time_modifier": "previous_year"
    },
    "format": "integer"
  },
  "units_vs_previous_year_pct": {
    "name": "% Desviación Unidades vs Anterior",
    "type": "derived",
    "formula": "(units_used - units_used_previous_year) / units_used_previous_year",
    "format": "percent"
  },
  "revenue_per_unit": {
    "name": "Ingreso por Tractocamión",
    "type": "derived",
    "formula": "trip_revenue / units_used if units_used else 0",
    "format": "currency"
  },
  "revenue_per_unit_previous_year": {
    "name": "Ingreso por Unidad Año Anterior",
    "type": "derived",
    "formula": "trip_revenue_previous_year / units_used_previous_year if units_used_previous_year else 0",
    "format": "currency"
  },

  "clients_served": {
    "name": "Clientes Servidos",
    "recipe": {
      "table": "d_trafico_guia",
      "column": "id_cliente",
      "aggregation": "DISTINCTCOUNT"
    },
    "format": "integer"
  },
  "clients_served_previous_year": {
    "name": "Clientes Servidos Año Anterior",
    "recipe": {
      "table": "d_trafico_guia",
      "column": "id_cliente",
      "aggregation": "DISTINCTCOUNT",
      "time_modifier": "previous_year"
    },
    "format": "integer"
  },
  "clients_vs_previous_year_pct": {
    "name": "% Desviación Clientes vs Anterior",
    "type": "derived",
    "formula": "(clients_served - clients_served_previous_year) / clients_served_previous_year",
    "format": "percent"
  },

  "loaded_trips": {
    "name": "Viajes con Carga",
    "recipe": {
      "table": "d_viaje",
      "column": "ind_cargado",
      "aggregation": "SUM"
    },
    "format": "integer"
  },
  "fleet_utilization": {
    "name": "Porcentaje de Carga",
    "type": "derived",
    "formula": "loaded_trips / trips if trips else 0",
    "format": "percent"
  },

  "fuel_yield": {
    "name": "Rendimiento Combustible",
    "type": "placeholder",
    "default_value": 0,
    "format": "decimal",
    "description": "Pendiente: requiere tabla de combustible"
  },
  "fuel_yield_previous_year": {
    "name": "Rendimiento Combustible Año Anterior",
    "type": "placeholder",
    "default_value": 0,
    "format": "decimal"
  },
  "total_liters": {
    "name": "Litros Totales",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer",
    "description": "Pendiente: requiere tabla de combustible"
  },

  "bank_balance": {
    "name": "Saldo Bancos",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de bancos/tesorería"
  },
  "income_month": {
    "name": "Ingresos del Mes",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de tesorería"
  },
  "expenses_month": {
    "name": "Egresos del Mes",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de tesorería"
  },
  "cash_flow": {
    "name": "Flujo de Caja",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "accounts_receivable": {
    "name": "Cuentas por Cobrar",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de cartera"
  },
  "accounts_payable": {
    "name": "Cuentas por Pagar",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de proveedores"
  },
  "collection_efficiency": {
    "name": "Eficiencia de Cobranza",
    "type": "placeholder",
    "default_value": 0,
    "format": "percent"
  },
  "avg_collection_days": {
    "name": "Días Promedio de Cobro",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer"
  },
  "liquidity_ratio": {
    "name": "Ratio de Liquidez",
    "type": "placeholder",
    "default_value": 0,
    "format": "decimal"
  },
  "working_capital": {
    "name": "Capital de Trabajo",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },

  "internal_cost": {
    "name": "Costo Mtto Interno",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de órdenes de servicio"
  },
  "external_cost": {
    "name": "Costo Mtto Externo",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "tire_cost": {
    "name": "Costo Llantas",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "total_maintenance": {
    "name": "Gasto Mtto Total",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "maintenance_cost_per_km": {
    "name": "Costo Mtto x Km",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "availability_percent": {
    "name": "% Disponibilidad",
    "type": "placeholder",
    "default_value": 0,
    "format": "percent"
  },
  "workshop_entries": {
    "name": "Entradas a Taller",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer"
  },
  "corrective_cost": {
    "name": "Costo Correctivo",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "preventive_cost": {
    "name": "Costo Preventivo",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "avg_repair_time": {
    "name": "Tiempo Promedio Reparación",
    "type": "placeholder",
    "default_value": 0,
    "format": "decimal"
  },
  "units_in_workshop": {
    "name": "Unidades en Taller",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer"
  },
  "pending_orders": {
    "name": "Órdenes Pendientes",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer"
  },
  "mtto_interno": {
    "name": "Mtto Interno",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "mtto_externo": {
    "name": "Mtto Externo",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "mtto_llantas": {
    "name": "Mtto Llantas",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },

  "total_purchases": {
    "name": "Compras Totales",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de compras"
  },
  "fuel_purchases": {
    "name": "Compras Combustible",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "parts_purchases": {
    "name": "Compras Refacciones",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "tire_purchases": {
    "name": "Compras Llantas",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },

  "initial_inventory": {
    "name": "Inventario Inicial",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency",
    "description": "Pendiente: requiere tabla de inventario"
  },
  "current_valuation": {
    "name": "Valorización Actual",
    "type": "placeholder",
    "default_value": 0,
    "format": "currency"
  },
  "compliance_level": {
    "name": "Nivel de Cumplimiento",
    "type": "placeholder",
    "default_value": 0,
    "format": "percent"
  },
  "items_with_stock": {
    "name": "Artículos con Stock",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer"
  },
  "items_without_stock": {
    "name": "Artículos sin Stock",
    "type": "placeholder",
    "default_value": 0,
    "format": "integer"
  }
}